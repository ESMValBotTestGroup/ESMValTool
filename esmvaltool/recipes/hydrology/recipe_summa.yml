# ESMValTool
# recipe_summa.yml
---
documentation:
  description: |
    Recipe pre-processes ERA-Interim and ERA5 files for use in the SUMMA hydrological model.

    Summa is ...
  authors: ['kalverla_peter', 'camphuijsen_jaro', 'alidoost_sarah']
  projects: ['ewatercycle']
  references: ['acknow_project']


preprocessors:
  extract_region: &region # TODO fix this preprocessor
    extract_region:
      start_longitude:
      end_longitude:
      start_latitude:
      end_latitude:
  regrid: &regrid
    regrid:
      target_grid: 0.25x0.25
      lon_offset: true
      lat_offset: true
      scheme: linear
  # SUMMA is semi-distributed; it works with Hydrological Response Units (HRUs)
  # These are lumped subcatchments, so we could use Inti's `decomposed` function.
  # Another option is to consider gridcells as HRU's, making it a gridded model.
  # The latter is what was done in the Lorentz workshop.
  # However, I can't find the necessary input shapefiles; for now use Inti's (for HYPE)
  extract_meuse: &Meuse
    extract_shape:
      shapefile: HYPE_Shapefiles/Meuse_HYPE/Meuse_HYPE.shp
      method: contains
      decomposed: true
  save_memory: &save_memory
    extract_time:
      end_year: 2000
      end_month: 1
      end_day: 3
  daily_mean: &mean
    daily_statistics:
      operator: mean
  hourly_mean:
    <<: *save_memory
    <<: *Meuse
    <<: *mean
  daily:
    <<: *region
    <<: *regrid
    <<: *Meuse

diagnostics:
  diagnostic_daily:
    description: SUMMA input preprocessor for daily data
    additional_datasets:
      - {dataset: ERA-Interim, project: OBS6, tier: 3, type: reanaly, version: 1}
    variables:
      tas: &var_daily
        mip: day
        start_year: 2000
        end_year: 2000
        preprocessor: daily
      uas: *var_daily
      vas: *var_daily
      pr: *var_daily
      tdps:
        <<: *var_daily
        mip: Eday
      rsds: *var_daily
      rlds: *var_daily
      ps: *var_daily
    scripts:
      script:
        script: hydrology/summa.py

  diagnostic_hourly:
    description: SUMMA input preprocessor for hourly data
    additional_datasets:
      - {dataset: ERA5, project: OBS6, tier: 3, type: reanaly, version: 1}
    variables:
      uas: &var_hourly
        mip: E1hr
        start_year: 2000
        end_year: 2000
        preprocessor: hourly_mean
      vas:
        <<: *var_hourly
        preprocessor: hourly_mean
      tas:
        <<: *var_hourly
        preprocessor: hourly_mean
      tdps:
        <<: *var_hourly
        preprocessor: hourly_mean
      pr:
        <<: *var_hourly
        preprocessor: hourly_mean
      rsds:
        <<: *var_hourly
        preprocessor: hourly_mean
      rlds:
        <<: *var_hourly
        preprocessor: hourly_mean
      ps:
        <<: *var_hourly
        preprocessor: hourly_mean
    scripts:
      script:
        script: hydrology/summa.py
