# ESMValTool
# recipe_climwip.yml
---
documentation:
  description: EUCP ClimWIP 

  authors:
    - kalverla_peter
    - camphuijsen_jaro
#     - brunner_lukas

  maintainer:
    - kalverla_peter
    - camphuijsen_jaro
#     - brunner_lukas

  references:
    - "Brunner, L. et al. (2019): Quantifying uncertainty in European climate projections using combined performance-independence weighting. Eniron. Res. Lett. DOI: 10.1088/1748-9326/ab492f"

    - "Lorenz, R. et al. (2018): Prospects and caveats of weighting climate models for summer maximum temperature projections over North America. Journal of Geophysical Research: Atmospheres, 123, 4509–4526. DOI: 10.1029/2017JD027992"

    - "Knutti, R. at al. (2017): A climate model projection weighting scheme accounting for performance and interdependence, Geophys. Res. Lett., 44, 1909–1918. DOI 10.1002/2016GL072012"



# TODO select the right datasets and include observations
datasets:
  - {dataset: ACCESS1-0, project: CMIP5, exp: historical, ensemble: r(1:3)i1p1, start_year: 1995, end_year: 2014}
  - {dataset: ACCESS1-3, project: CMIP5, exp: historical, ensemble: r(1:3)i1p1, start_year: 1995, end_year: 2014}
  - {dataset: CCSM4, project: CMIP5, exp: historical, ensemble: r(1:4)i1p1, start_year: 1995, end_year: 2014}
  - {dataset: ACCESS1-0, project: CMIP5, exp: rcp85, ensemble: r1i1p1, start_year: 1995, end_year: 2014}
  - {dataset: ACCESS1-3, project: CMIP5, exp: rcp85, ensemble: r1i1p1, start_year: 1995, end_year: 2014}
  - {dataset: CCSM4, project: CMIP5, exp: rcp85, ensemble: r(1:4)i1p1, start_year: 1995, end_year: 2014}


# TODO extend this preprocessor to adhere to ClimWIP methods (extract shape / extract points)
preprocessors:
  all_methods: &shared
    regrid:
      target_grid: 2.5x2.5
      scheme: linear
    mask_landsea:
      mask_out: sea
    extract_region:
      start_longitude: -10.0
      end_longitude: 39.0
      start_latitude: 30.0
      end_latitude: 76.25
  
  climWip_specific: &climwip
    extract_season:
      season: JJA
    climate_statistics:
      operator: mean
  
  climWip_complete:
    <<: *shared
    <<: *climwip

# TODO add another diagnostic for plotting and more variables
diagnostics:
  inspect_preprocessed_files:
    variables:
      tas:
        mip: Amon
        preprocessor: climWip_complete
      pr:  
        mip: Amon
        preprocessor: climWip_complete
    scripts:
      visualize_region:
        script:
          weighting/visualize_region.py

  apply_climwip:
    variables:
      tas:
        mip: Amon
      pr:  
        mip: Amon
    scripts:
      climwip: 
        script: weighting/climwip.py
        shape_params: {D_tas : 0.588, D_pr: 0.658, S: 0.704}